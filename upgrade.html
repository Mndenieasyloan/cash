<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mndeni Easy Loans - Agreement Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            min-height: 100vh;
            padding: 10px;
        }
        
        .input-container {
            max-width: 800px;
            margin: 0 auto 30px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .input-container h1 {
            color: #0d7377;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
        }
        
        .input-container p {
            margin-bottom: 15px;
            color: #555;
        }
        
        .format-example {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border-left: 4px solid #0d7377;
        }
        
        .input-container textarea {
            width: 100%;
            height: 350px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            margin-top: 15px;
        }
        
        .input-container textarea:focus {
            outline: none;
            border-color: #0d7377;
            box-shadow: 0 0 0 3px rgba(13, 115, 119, 0.1);
        }
        
        .btn-container {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .btn {
            padding: 14px 35px;
            font-size: 15px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #0d7377;
            color: white;
        }
        
        .btn-primary:hover {
            background: #095456;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #f5c518;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0b315;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* PDF Document Container */
        .pdf-document {
            display: none;
            font-family: Arial, sans-serif;
            color: #333;
        }
        
        .pdf-document.visible {
            display: block;
            margin: 30px auto;
            width: fit-content;
        }
        
        /* A4 Page */
        .a4-page {
            width: 210mm;
            height: 297mm;
            padding: 10mm 9mm; /* Increased padding slightly */
            background: white;
            box-shadow: 0 0 25px rgba(0,0,0,0.15);
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }
        
        /* Header Section - Page 1 */
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 5px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ncr-logo { height: 50px; width: auto; }
        .sa-coat-of-arms { height: 50px; width: auto; }
        .small-coat { height: 45px; margin-bottom: 2px; }
        
        .company-info {
            text-align: right;
            font-size: 10pt; /* Increased */
            line-height: 1.3;
        }
        
        .company-info .ncr-reg { color: #0d7377; font-weight: bold; }
        .company-info .legal-reg { color: #c41e3a; font-weight: bold; }
        .company-info a { color: #0d7377; text-decoration: underline; }
        .company-info .date-line { font-weight: bold; margin-top: 4px; }
        
        /* Compact Header for Pages 2 & 3 */
        .secondary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #0d7377;
            padding-bottom: 8px;
            margin-bottom: 20px; /* Increased spacing */
        }
        .secondary-header .logos img { height: 40px; margin-right: 8px; }
        .secondary-header .doc-ref { font-size: 10pt; font-weight: bold; color: #555; text-align: right; }

        /* Mndeni Logo */
        .mndeni-logo-section { margin: 5px 0; }
        .mndeni-logo {
            font-size: 36pt; /* Increased */
            font-weight: bold;
            color: #0d7377;
            letter-spacing: -2px;
            line-height: 1;
        }
        .mndeni-logo span { color: #f5c518; }
        
        .barcode {
            margin-top: 5px;
            height: 15px;
            width: 150px;
            background: repeating-linear-gradient(90deg, #000 0px, #000 2px, transparent 2px, transparent 4px, #000 4px, #000 5px, transparent 5px, transparent 8px, #000 8px, #000 10px, transparent 10px, transparent 11px, #000 11px, #000 12px, transparent 12px, transparent 15px);
        }
        
        .contract-info {
            font-weight: bold;
            margin: 15px 0;
            font-size: 10pt; /* Increased */
        }
        
        .main-title {
            text-align: center;
            font-size: 16pt; /* Increased */
            font-weight: bold;
            color: #0d7377;
            margin: 15px 0;
            text-decoration: underline;
        }
        
        .parties-section {
            text-align: center;
            margin: 15px 0;
            font-size: 10pt; /* Increased */
            line-height: 1.4;
        }
        
        .parties-section h3 { color: #333; margin: 8px 0 4px; font-size: 10.5pt; }
        .parties-section .company-name { color: #0d7377; font-weight: bold; }
        .parties-section .borrower-info { color: #0d7377; font-weight: bold; }
        .parties-section .mndeni-highlight { color: #f5c518; font-weight: bold; }
        
        .intro-text {
            margin: 5px 0;
            text-align: left;
            font-size: 7pt; /* Increased */
            line-height: 1;
            text-align: center;

        }
        .intro-text p { margin-bottom: 6px; }
        
        /* Loan Table */
        .loan-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .loan-table th {
            background: #0d7377;
            color: white;
            padding: 8px; /* Increased padding */
            text-align: center;
            font-size: 10pt; /* Increased */
        }
        .loan-table td {
            padding: 8px; /* Increased padding */
            text-align: center;
            border: 1px solid #ddd;
            font-weight: bold;
            font-size: 10pt; /* Increased */
        }
        
        /* Section Styling */
        .section-title {
            color: #0d7377;
            font-weight: bold;
            margin: 12px 0 4px; /* Increased spacing */
            font-size: 10pt; /* Increased */
            text-transform: uppercase;
        }
        
        .section-title1 {
            color: #0d7377;
            font-weight: bold;
            margin: 12px 0 4px;
            font-size: 10pt;
            text-transform: uppercase;
        }
        
        .section-content, .section-content1 {
            margin: 0 0 1px 0;
            text-align: justify;
            font-size: 11pt; /* Increased from 8.5pt */
            line-height: 1; /* Increased from 1.35 */
        }
        
        .section-content p { margin-bottom: 8px; }
        
        /* Debit Order Box Styling */
        .debit-order-box {
            background: #faf9f5;
            border: 1px solid #d6b94b;
            padding: 10px 50px; /* Increased padding */
            border-radius: 8px;
            margin: 10px 0;
        }
        .debit-order-box .section-title { margin-top: 0; color: #b89a26; }

        /* Signature Section */
        .signature-title { color: #0d7377; font-weight: bold; font-size: 10.5pt; margin: 25px 0 10px; }
        .signatures-label { font-weight: bold; margin-bottom: 10px; font-size: 10pt; }
        
        .signature-section { display: flex; justify-content: space-between; margin-top: 20px; }
        .signature-box { width: 45%; }
        .signature-box h4 { color: #0d7377; font-weight: bold; margin-bottom: 10px; font-size: 10pt; }
        
        .signature-line {
            border-bottom: 1px solid #D6B94B;
            margin-bottom: 5px;
            height: 40px; /* Increased height */
            display: flex;
            align-items: flex-end;
            padding-bottom: 4px;
        }
        
        .signature-label { font-size: 9pt; }
        .name-line { margin-top: 8px; color: #333; font-size: 10pt; }
        .date-line-sig { margin-top: 6px; font-size: 10pt; }
        
        .bullet-item { margin-left: 20px; margin-top: 5px; font-size: 10pt; line-height: 1.5; }
        
        /* Page footer */
        .page-footer {
            position: absolute;
            bottom: 10mm;
            left: 20mm;
            right: 20mm;
            text-align: center;
            font-size: 8pt;
            color: #999;
            border-top: 1px solid #ddd;
            padding-top: 8px;
        }
        
        /* Print Styles */
        @media print {
            body { background: white; padding: 0; margin: 0; }
            .input-container { display: none !important; }
            .pdf-document { display: block !important; }
            .a4-page {
                box-shadow: none !important;
                margin: 0 !important;
                page-break-after: always !important;
                page-break-inside: avoid !important;
            }
        }

        /* Loading Overlay */
        .loading-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 9999;
        }
        .loading-overlay.visible { display: flex; }
        .loading-box { background: white; padding: 30px 50px; border-radius: 12px; text-align: center; }
        .spinner {
            width: 40px; height: 40px; border: 4px solid #ddd; border-top-color: #0d7377;
            border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-box">
            <div class="spinner"></div>
            <p>Generating PDF...</p>
        </div>
    </div>

    <div class="input-container">
        <h1>Mndeni Easy Loans - Agreement Generator</h1>
        <p><strong>Paste all applicant details below in this exact format:</strong></p>
        <div class="format-example">
            Your full name<br>
            Willem Goosen<br><br>
            Loan Amount Needed<br>
            100 000<br><br>
            Loan Terms/Duration<br>
            48<br><br>
            Id Number<br>
            6110095002086<br><br>
            Account No: For Pay Out<br>
            1217674320<br><br>
            Reason for the Loan<br>
            Car Loan<br><br>
            Phone Number<br>
            0634431636
        </div>
        <textarea id="inputData" placeholder="Paste all the applicant details here exactly as shown above..."></textarea>
        <div class="btn-container">
            <button class="btn btn-primary" onclick="generateDocument()">Generate Agreement</button>
            <button class="btn btn-secondary" onclick="downloadPDF()" id="downloadBtn">Download PDF</button>
        </div>
    </div>

    <div class="pdf-document" id="pdfDocument">
        <!-- PAGE 1 -->
        <div class="a4-page" id="page1">
            <div class="header-section">
                <div class="logo-section">
                    <img src="image/img14.jpg" alt="NCR Logo" class="ncr-logo" crossorigin="anonymous">
                    <img src="image/img16.jpg" alt="SA Coat of Arms" class="sa-coat-of-arms" crossorigin="anonymous">
                </div>
                <div class="company-info">
                    <img src="image/img18.jpg" alt="SA Coat of Arms" class="small-coat" crossorigin="anonymous">
                    <div><span class="ncr-reg">NCR Reg No:</span> NCRCP19616 / <span class="legal-reg">Legal Reg No:</span> 2024/157205/07</div>
                    <div>12 Shopping Centre Rank Road Nqutu 3135,</div>
                    <div>South Africa Tel: +27813505496/0687777411)</div>
                    <div><a href="mailto:mndenieasyloan@aol.com">mndenieasyloan@aol.com</a></div>
                    <div class="date-line">Date: <span id="docDate"></span></div>
                </div>
            </div>

            <div class="mndeni-logo-section">
                <div class="mndeni-logo">Mndeni<span>.</span></div>
                <div class="barcode"></div>
            </div>
            
            <div class="contract-info">
                <div>CONTRACT NO: <span id="contractNo"></span> &nbsp;&nbsp;&nbsp; STATUS: <span style="color:#b71c1c; font-size:18px; font-weight:bold;">Application Approved</span></div>
                <div>EFFECTIVE DATE: <span id="effectiveDate"></span></div>
            </div>

            <h1 class="main-title">MNDENI EASY LOAN AGREEMENT & APPROVAL FOR A <span id="loanTypeTitle">LOAN</span> LOAN</h1>

            <div class="parties-section">
                <h3>BETWEEN THE PARTIES: THE LENDER (MNDENI):</h3>
                <div><span class="company-name">Mndeni Easy Loans (Registration No: NCRCP19616)</span></div>
                <div><strong>Principal Place of Business: 12 Shopping Centre, Rank Road, Nqutu, 3135</strong></div>
                <div><strong>Contact: mndenieasyloan@aol.com</strong></div>
                <div>(Hereinafter referred to as the <strong>Lender: <span class="mndeni-highlight">Mndeni</span></strong>.)</div>
                
                <h3 style="margin-top: 10px;">& THE BORROWER (YOU):</h3>
                <div class="borrower-info">Full Name: <span id="borrowerName"></span> -- S.A ID Number: <span id="borrowerId"></span></div>
                <div class="borrower-info">Phone Number: <span id="borrowerPhone"></span></div>
                <div class="borrower-info">Designated Account for Disbursement & Repayment: <span id="borrowerAccount"></span></div>
                <div class="borrower-info">Loan Type: <span id="borrowerLoanType"></span></div>
                <div>(Hereinafter referred to as the "Borrower (YOU)")</div>
            </div>

            <div class="intro-text">
                <p>The Lender (Mndeni) and the Borrower (YOU) are collectively referred to as the "Parties."</p>
                <p>A. The Borrower (YOU) has submitted an application for a <span id="loanTypeIntro">credit</span> facility.</p>
                <p>B. The Lender (Mndeni), having assessed said application, hereby extends a formal offer of credit on the terms and conditions set forth herein.</p>
                <p><strong>NOW THEREFORE,</strong> in consideration of the mutual promises and covenants contained herein, the Parties agree as follows: Repayment Plan below</p>
            </div>

            <table class="loan-table">
                <thead>
                    <tr>
                        <th>Loan Type</th>
                        <th>Loan Amount</th>
                        <th>Loan Duration</th>
                        <th>Monthly Repayment</th>
                        <th>Loan Interest</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="loanTypeTable"></td>
                        <td id="loanAmount"></td>
                        <td id="loanDuration"></td>
                        <td id="monthlyRepayment"></td>
                        <td>5% Per Annum</td>
                    </tr>
                </tbody>
            </table>

            <div class="section-title">SECTION 1: LOAN FACILITY & DISBURSEMENT</div>
            <div class="section-content">
                <p>1.1 <strong>Principal Sum.</strong> The Lender (Mndeni) hereby agrees to disburse to the Borrower (YOU) a <span id="loanTypeSection1"></span> in the principal amount of <strong><span id="principalAmount"></span></strong>.</p>
                <p>1.2 <strong>Interest Rate.</strong> The outstanding principal balance shall accrue interest at a fixed rate of <strong>five percent (5%) per annum</strong>, calculated from the date of disbursement until full and final settlement.</p>
            </div>

            <div class="section-title">SECTION 2: <span style="color:#1a237e; font-weight:bold;">PROCESSING CHARGES (REGULATED CHARGE)</span></div>
            <div class="section-content">
                <p><strong>2.1 Statutory Processing Charges</strong><br>
                In terms of the <span style="color:#0d47a1; font-weight:bold;">National Credit Act 34 of 2005 ("NCA")</span> and <span style="color:#0d47a1; font-weight:bold;">Regulation 42</span>, <em>"a credit provider may charge an initiation or processing fee in respect of a credit agreement."</em> Following approval of the loan application, a once-off 
                <span style="color:#b71c1c; font-size:18px; font-weight:bold;">R360 PROCESSING CHARGE</span> 
                is applicable. This charge is <span style="color:#1b5e20; font-weight:bold;">legally permitted</span>, <span style="color:#1b5e20; font-weight:bold;">regulated</span>, and falls within the prescribed limits set by the NCA.</p>

                <p><strong>2.2 Purpose, Disclosure & Payment</strong><br>
                The <span style="font-weight:bold; color:#1a237e;">Processing Charge</span> covers <span style="font-weight:bold;">application processing</span>, <span style="font-weight:bold;">credit and affordability assessment</span>, and <span style="font-weight:bold;">compliance verification</span>. It forms part of the total cost of credit and is <span style="color:#b71c1c; font-weight:bold;">payable prior to disbursement of the approved loan funds</span>. Once administrative processing has commenced, the Processing Charge is <span style="font-weight:bold;">non-refundable</span>.</p>
            </div>
            
            <div class="page-footer">Page 1 of 3 | Mndeni Easy Loans Loan Agreement</div>
        </div>

        <!-- PAGE 2 -->
        <div class="a4-page" id="page2">
            <div class="secondary-header">
                <div class="logos">
                    <img src="image/img14.jpg" alt="NCR Logo" crossorigin="anonymous">
                    <img src="image/img16.jpg" alt="SA Coat of Arms" crossorigin="anonymous">
                </div>
                <div class="doc-ref">
                    Mndeni Easy Loans | Contract No: <span id="contractNoPage2"></span>
                </div>
            </div>

            <div class="section-title">SECTION 3: REPAYMENT SCHEDULE</div>
            <div class="section-content">
                <p>3.1 <strong>Installment Plan.</strong> The Borrower (YOU) agrees to repay the <span id="loanTypeSection3"></span> over <strong><span id="repaymentMonths"></span></strong> in installments of <strong><span id="installmentAmount"></span></strong> each month.</p>
                <p>3.2 <strong>Payment Date.</strong> Installments shall be debited automatically on the Borrower (YOU)'s chosen day of each month, commencing one calendar month from the date of loan disbursement.</p>
                <p>3.3 <strong>Prepayment Privilege.</strong> The Borrower (YOU) may settle the outstanding balance, in part or in full, at any time prior to the scheduled maturity date without incurring any prepayment penalty or fee.</p>
            </div>

            <div class="section-title">SECTION 4: DEBIT ORDER AUTHORIZATION</div>
            <div class="section-content">
                <p>4.1 The Borrower (YOU) hereby authorizes the Lender (Mndeni) (and its appointed agents) to issue and deliver payment instructions to the Borrower (YOU)'s bank for the collection of all amounts due under this Agreement via direct debit.</p>
                <p>4.2 This authority shall remain in full force and effect until the Lender (Mndeni) receives written notice of cancellation from the Borrower (YOU), provided no less than 20 business days before the next debit date. Cancellation does not remove liability for amounts already due.</p>
            </div>

            <div class="debit-order-box">
                <div class="section-title">STANDING DEBIT ORDER AUTHORIZATION</div>
                <div class="section-content" style="margin-bottom: 0;">
                    <p>I/We, <strong><span id="debitAuthName"></span></strong>, hereby authorize Mndeni Easy Loans (or its appointed agent) to draw against my/our account held at the bank specified below, the monthly installments as specified in Section 3 of this Agreement.</p>
                    <p><strong>Account Number:</strong> <span id="debitAccountNo"></span> &nbsp;&nbsp;&nbsp; <strong>Bank Name:</strong> ____________________</p>
                    <p><strong>Debit Amount for Monthly Repayment Only:</strong> <span id="debitAmount"></span></p>
                    <p><strong>Debit Day:</strong> The _____ day of each month, commencing. <strong>This mandate shall remain in effect until the full loan obligation is settled, subject to the terms of this Agreement.</strong></p>
                    <p style="margin-top: 15px;"><strong>Sign Here to Authorize Debit Order:</strong> _________________________ &nbsp;&nbsp;&nbsp; <strong>Date:</strong> <span id="signDate"></span></p>
                    <p><strong>Borrower (YOU)</strong></p>
                </div>
            </div>

            <div class="section-title">SECTION 5: CREDIT ENHANCEMENT COVENANT</div>
            <div class="section-content">
                <p>5.1 The Borrower (YOU) acknowledges that this Agreement may assist in rebuilding their credit profile. The Lender (Mndeni), with the Borrower (YOU)'s consent, may report positive repayment performance to registered credit bureaus to support future credit improvement.</p>
            </div>

            <div class="section-title1">SECTION 6: DEFAULT AND REMEDIES</div>
            <div class="section-content1">
                <p>6.1 <strong>Event of Default.</strong> A default shall occur if the Borrower (YOU) fails to remit any monthly installment for more than thirty-one (31) days from its due date, becomes insolvent, breaches any material term of this Agreement, or if any representation is found to be false.</p>
                <p>6.2 <strong>Consequences of Default.</strong> Upon default, the Lender (Mndeni) reserves the right to: (i) Declare the entire outstanding balance immediately due; (ii) Pursue all available legal remedies to recover the debt; and (iii) Report the default to registered credit bureaus.</p>
                <p>6.3 <strong>Grace Period.</strong> The Lender (Mndeni) encourages communication in case of financial difficulty.</p>
            </div>

            <div class="section-title">SECTION 7: ADDITIONAL TERMS AND CONDITIONS</div>
            <div class="section-content">
                <p>7.1 <strong>Entire Agreement.</strong> This Agreement constitutes the entire agreement between the Parties.</p>
                <p>7.2 <strong>Waiver.</strong> No waiver of any provision shall be effective unless in writing and signed.</p>
                <p>7.3 <strong>Assignment.</strong> The Borrower (YOU) may not transfer obligations without written consent. The Lender (Mndeni) may assign its rights.</p>
                <p>7.4 <strong>Notices.</strong> All notices must be in writing and properly delivered.</p>
                <p>7.5 <strong>Force Majeure.</strong> Neither party shall be liable for delays caused by circumstances beyond reasonable control.</p>
            </div>

            <div class="page-footer">Page 2 of 3 | Mndeni Easy Loans Loan Agreement</div>
        </div>
        
        <!-- PAGE 3 -->
        <div class="a4-page" id="page3">
            <div class="secondary-header">
                <div class="logos">
                    <img src="image/img14.jpg" alt="NCR Logo" crossorigin="anonymous">
                    <img src="image/img16.jpg" alt="SA Coat of Arms" crossorigin="anonymous">
                </div>
                <div class="doc-ref">
                    Mndeni Easy Loans | Contract No: <span id="contractNoPage3"></span>
                </div>
            </div>

            <div class="section-title">SECTION 8: CONFIDENTIALITY</div>
            <div class="section-content">
                <p>8.1 Both Parties agree to maintain confidentiality of information exchanged under this Agreement.</p>
                <p>8.2 The Lender (Mndeni) shall comply with applicable data protection laws in handling the Borrower's personal information.</p>
            </div>

            <div class="section-title">SECTION 9: GENERAL PROVISIONS</div>
            <div class="section-content">
                <p>9.1 <strong>Governing Law.</strong> This Agreement shall be governed by the laws of the Republic of South Africa, with reference to the National Credit Act (Act 34 of 2005). The Parties submit to the jurisdiction of the Magistrate's Court of KwaZulu-Natal.</p>
                <p>9.2 <strong>Amendments.</strong> Any amendment must be in writing and signed by both Parties.</p>
                <p>9.3 <strong>Severability.</strong> If any provision is found invalid, the remaining provisions remain enforceable.</p>
                <p>9.4 <strong>Dispute Resolution.</strong> The Parties agree to attempt good-faith negotiation before mediation or court proceedings.</p>
            </div>

            <div class="section-title" style="margin-top: 30px;">BORROWER (YOU)'S ACKNOWLEDGEMENT & ACCEPTANCE</div>
            <div class="section-content">
                <p>By signing below, the Borrower (YOU) hereby:</p>
                <div class="bullet-item">
                    <p><input type="checkbox"> • Accepts the approved <span id="loanTypeAcceptance"></span> of <strong><span id="acceptedLoanAmount"></span></strong> under the terms stated above</p>
                    <p><input type="checkbox"> • Accepts the <strong>R360 PROCESSING CHARGE</strong> as disclosed in Section 2 above</p>
                </div>
            </div>

            <div class="signature-title">SIGNATURE FOR THE LENDER (MNDENI):</div>
            <p class="signatures-label">Signatures</p>

            <div class="signature-section">
                <div class="signature-box">
                    <h4>Lender (Mndeni):</h4>
                    <div class="signature-">
                        <img src="image/download (2).png" alt="Lender Signature" style="max-width: 250px; height: auto;">
                    </div>
                    <div class="date-line-sig">
                        <strong>Date:</strong> <span id="lenderSignDate"></span>
                    </div>
                </div>

                <div class="signature-box">
                    <h4>Borrower (YOU):</h4>
                    <div class="signature-line" style="margin-top: 45px;"></div>
                    <div class="signature-label">
                        <strong>Signature:</strong> 
                    </div>
                    <div class="name-line">
                        <strong>Name:</strong> _______________________
                    </div>
                    <div class="date-line-sig">
                        <strong>Date:</strong> <span id="borrowerSignDate"></span>
                    </div>
                </div>
            </div>

            <div style="margin-top: 50px; padding-top: 20px; border-top: 2px solid #0d7377;">
                <div style="text-align: center; margin-bottom: 15px;">
                    <div class="mndeni-logo" style="font-size: 28pt;">Mndeni<span>.</span></div>
                    <p style="font-size: 9.5pt; color: #666; margin-top: 5px;">
                        <em>"Empowering Financial Growth Through Responsible Lending"</em>
                    </p>
                </div>

                <p style="font-size: 9pt; text-align: center; color: #666;">
                    This document is a legally binding agreement. Please retain a copy for your records.<br>
                    For any queries, contact us at mndenieasyloan@aol.com or +27813505496
                </p>
            </div>

            <div class="page-footer">
                Page 3 of 3 | Mndeni Easy Loans Loan Agreement | Contract No: <span id="contractNoFooter"></span>
            </div>
        </div>
    </div>

    <script>
        function parseInputData(text) {
            const lines = text.trim().split('\n').map(line => line.trim()).filter(line => line);
            const data = {
                fullName: '', loanAmount: 0, loanDuration: 0, idNumber: '', accountNo: '', loanType: '', phoneNumber: ''
            };

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].toLowerCase();
                
                if (line.includes('full name') || line.includes('your full name')) {
                    if (i + 1 < lines.length && !lines[i + 1].toLowerCase().includes('loan') && !lines[i + 1].toLowerCase().includes('id') && !lines[i + 1].toLowerCase().includes('account')) {
                        data.fullName = lines[i + 1];
                    }
                }
                if (line.includes('loan amount')) {
                    if (i + 1 < lines.length) {
                        const amount = parseFloat(lines[i + 1].replace(/[^0-9.]/g, ''));
                        if (!isNaN(amount)) data.loanAmount = amount;
                    }
                }
                if (line.includes('loan term') || line.includes('duration')) {
                    if (i + 1 < lines.length) {
                        const months = parseInt(lines[i + 1].replace(/[^0-9]/g, ''));
                        if (!isNaN(months)) data.loanDuration = months;
                    }
                }
                if (line.includes('id number') || line === 'id') {
                    if (i + 1 < lines.length) data.idNumber = lines[i + 1].replace(/[^0-9]/g, '');
                }
                if (line.includes('account') && (line.includes('pay out') || line.includes('payout') || line.includes('no'))) {
                    if (i + 1 < lines.length) data.accountNo = lines[i + 1].replace(/[^0-9]/g, '');
                }
                if (line.includes('reason for') || line.includes('loan type') || line.includes('reason for the loan')) {
                    if (i + 1 < lines.length) {
                        let nextLine = lines[i + 1];
                        if (!nextLine.toLowerCase().includes('ago') && !nextLine.toLowerCase().includes('phone')) {
                            data.loanType = nextLine;
                        }
                    }
                }
                if (line.includes('phone') || line.includes('cell') || line.includes('mobile') || line.includes('contact number')) {
                    if (i + 1 < lines.length) {
                        let nextLine = lines[i + 1];
                        if (!nextLine.toLowerCase().includes('ago')) {
                            data.phoneNumber = nextLine.replace(/[^0-9+]/g, '');
                        }
                    }
                }
            }
            if (!data.loanType) data.loanType = 'Personal Loan';
            return data;
        }

        function formatLoanType(loanType) {
            if (!loanType) return 'Personal Loan';
            const type = loanType.toLowerCase().trim();
            if (type.includes('car') || type.includes('vehicle') || type.includes('auto')) return 'Car Loan';
            else if (type.includes('business')) return 'Business Loan';
            else if (type.includes('personal')) return 'Personal Loan';
            else if (type.includes('home') || type.includes('house') || type.includes('mortgage')) return 'Home Loan';
            else if (type.includes('education') || type.includes('student') || type.includes('school')) return 'Education Loan';
            else if (type.includes('medical') || type.includes('health')) return 'Medical Loan';
            else if (type.includes('debt') || type.includes('consolidation')) return 'Debt Consolidation Loan';
            else if (type.includes('emergency')) return 'Emergency Loan';
            else return loanType.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ');
        }

        function calculateMonthlyInstallment(loanAmount, months) {
            const interest = loanAmount * 0.05;
            const totalAmount = loanAmount + interest;
            return totalAmount / months;
        }

        function formatCurrency(amount) {
            return 'R' + amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function formatDate(date) {
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
        }

        function generateContractNo(accountNo) {
            const year = new Date().getFullYear();
            const month = String(new Date().getMonth() + 1).padStart(2, '0');
            return `MEL-${year}-${month}-${accountNo}`;
        }

        function formatPhoneNumber(phone) {
            if (!phone) return 'N/A';
            if (phone.length === 10 && phone.startsWith('0')) {
                return phone.replace(/(\d{3})(\d{3})(\d{4})/, '$1 $2 $3');
            }
            return phone;
        }

        function generateDocument() {
            const inputText = document.getElementById('inputData').value;
            
            if (!inputText.trim()) {
                alert('Please paste the applicant details first!');
                return;
            }

            const data = parseInputData(inputText);

            if (!data.fullName || !data.loanAmount || !data.loanDuration) {
                alert('Could not parse all required data. Please ensure you paste the data in the correct format.');
                return;
            }

            const today = new Date();
            const monthlyPayment = calculateMonthlyInstallment(data.loanAmount, data.loanDuration);
            const contractNo = generateContractNo(data.accountNo);
            const formattedLoanType = formatLoanType(data.loanType);

            // Populate document fields
            document.getElementById('docDate').textContent = formatDate(today);
            document.getElementById('contractNo').textContent = contractNo;
            document.getElementById('contractNoPage2').textContent = contractNo;
            document.getElementById('contractNoPage3').textContent = contractNo;
            document.getElementById('contractNoFooter').textContent = contractNo;
            document.getElementById('effectiveDate').textContent = formatDate(today).toUpperCase();
            document.getElementById('borrowerName').textContent = data.fullName.toUpperCase();
            document.getElementById('borrowerId').textContent = data.idNumber;
            document.getElementById('borrowerAccount').textContent = data.accountNo;
            document.getElementById('borrowerPhone').textContent = formatPhoneNumber(data.phoneNumber);
            document.getElementById('borrowerLoanType').textContent = formattedLoanType;
            document.getElementById('loanAmount').textContent = formatCurrency(data.loanAmount);
            document.getElementById('loanDuration').textContent = data.loanDuration + ' Months';
            document.getElementById('monthlyRepayment').textContent = formatCurrency(monthlyPayment);
            document.getElementById('principalAmount').textContent = formatCurrency(data.loanAmount);
            document.getElementById('repaymentMonths').textContent = data.loanDuration + ' Months';
            document.getElementById('installmentAmount').textContent = formatCurrency(monthlyPayment);
            document.getElementById('debitAuthName').textContent = data.fullName.toUpperCase();
            document.getElementById('debitAccountNo').textContent = data.accountNo;
            document.getElementById('debitAmount').textContent = formatCurrency(monthlyPayment);
            document.getElementById('signDate').textContent = formatDate(today);
            document.getElementById('acceptedLoanAmount').textContent = formatCurrency(data.loanAmount);
            document.getElementById('lenderSignDate').textContent = today.toLocaleDateString('en-GB');
            document.getElementById('borrowerSignDate').textContent = today.toLocaleDateString('en-GB');

            // Populate loan type fields
            document.getElementById('loanTypeTitle').textContent = formattedLoanType.toUpperCase().replace(' LOAN', '');
            document.getElementById('loanTypeTable').textContent = formattedLoanType;
            document.getElementById('loanTypeIntro').textContent = formattedLoanType.toLowerCase();
            document.getElementById('loanTypeSection1').textContent = formattedLoanType.toLowerCase();
            document.getElementById('loanTypeSection3').textContent = formattedLoanType;
            document.getElementById('loanTypeAcceptance').textContent = formattedLoanType.toLowerCase();

            document.getElementById('pdfDocument').classList.add('visible');
            document.getElementById('pdfDocument').scrollIntoView({ behavior: 'smooth' });
        }

        async function downloadPDF() {
            const element = document.getElementById('pdfDocument');
            
            if (!element.classList.contains('visible')) {
                alert('Please generate the agreement first!');
                return;
            }

            const btn = document.getElementById('downloadBtn');
            btn.disabled = true;
            document.getElementById('loadingOverlay').classList.add('visible');

            const borrowerName = document.getElementById('borrowerName').textContent;
            const filename = `Mndeni_Loan_Agreement_${borrowerName.replace(/\s+/g, '_')}.pdf`;

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });

            const pages = document.querySelectorAll('.a4-page');
            const pageWidth = 210;
            const pageHeight = 297;

            for (let i = 0; i < pages.length; i++) {
                const page = pages[i];
                
                try {
                    const canvas = await html2canvas(page, {
                        scale: 2,
                        useCORS: true,
                        allowTaint: true,
                        logging: false,
                        backgroundColor: '#ffffff',
                        width: page.offsetWidth,
                        height: page.offsetHeight
                    });

                    const imgData = canvas.toDataURL('image/jpeg', 0.95);
                    
                    if (i > 0) {
                        pdf.addPage();
                    }
                    
                    pdf.addImage(imgData, 'JPEG', 0, 0, pageWidth, pageHeight);
                } catch (error) {
                    console.error('Error rendering page', i + 1, error);
                }
            }

            pdf.save(filename);
            
            btn.disabled = false;
            document.getElementById('loadingOverlay').classList.remove('visible');
        }
    </script>
</body>
</html>
